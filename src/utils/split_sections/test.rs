use crate::utils::select_unto_language_header::select_unto_language_header;
use super::*;

mod constants {
    pub const TEXT1: &str =  "===================================================
<page>
    <title>чиновник</title>
    <ns>0</ns>
    <id>1699107</id>
    <revision>
        <id>79826638</id>
        <parentid>76088000</parentid>
        <timestamp>2024-06-02T16:36:15Z</timestamp>
        <contributor>
        <username>WingerBot</username>
        <id>2024159</id>
        </contributor>
        <minor />
        \0\0\0\0\0\0\0
        <origin>79826638</origin>
        <model>wikitext</model>
        <format>text/x-wiki</format>
        <text bytes=\"2637\" sha1=\"om5bwhxhzxn132w4po4sv2u6hobn7hg\" xml:space=\"preserve\">==Bulgarian==

===Noun===
{{bg-noun|чино́вник|m|f=чино́вница}}

# [[official]], [[functionary]]

====Declension====
{{bg-ndecl|чино́вник&lt;(h)&gt;}}

{{topics|bg|Occupations}}

==Macedonian==

===Pronunciation===
* {{mk-IPA}}

===Noun===
{{mk-noun|m|чиновници|f=чиновничка|adj=чиновнички|dim=чиновниче}}

# [[official]], [[functionary]], [[bureaucrat]]

====Declension====
{{mk-decl-noun-m||чиновниц|p=1}}

{{C|mk|Occupations}}

==Russian==

===Pronunciation===
* {{ru-IPA|чино́вник}}
* {{audio|ru|Ru-чиновник.ogg}}

===Noun===
{{ru-noun+|чино́вник|a=an|f=чино́вница|adj=чино́вничий}}

# [[official]], [[functionary]], [[bureaucrat]]
#: {{uxi|ru|[[высокопоста́вленный]] '''чино́вник'''|'''a''' high-ranking '''official'''}}

====Declension====
{{ru-noun-table|чино́вник|a=an}}

====Related terms====
* {{l|ru|чин|g=m}}
* {{l|ru|чино́вничество|g=n}}

====Descendants====
* {{desc|hy|չինովնիկ|bor=1}}
* {{desc|en|chinovnik|bor=1}}
* {{desc|hu|csinovnyik|bor=1}}
* {{desc|izh|cinovnikka|bor=1}}
* {{desc|lt|valdininkas|clq=1}}
* {{desc|ro|cinovnic|bor=1}}
* {{desc|sh|činovnik|bor=1}}

===Noun===
{{ru-noun+|чино́вник}}

# {{lb|ru|dated|religion}} book on episcopal missals

====Declension====
{{ru-noun-table|чино́вник}}

{{topics|ru|Occupations}}

==Serbo-Croatian==

===Etymology===
{{bor+|sh|ru|чино́вникъ}} (modern spelling {{m|ru|чино́вник}}).

===Pronunciation===
* {{sh-IPA|чино̀внӣк}}
* {{hyphenation|sh|чин|ов|ник}}

===Noun===
{{sh-noun|g=m|head=чино̀внӣк|f=чино̀вница}}

# [[clerk]]

====Declension====
{{sh-decl-noun
|чино̀внӣк|чиновни́ци
|чиновни́ка|чиновни́ка̄
|чиновнику|чиновницима
|чиновника|чиновнике
|чиновниче|чиновници
|чиновнику|чиновницима
|чиновником|чиновницима
}}

{{C|sh|Occupations}}

==Ukrainian==

===Pronunciation===
* {{uk-IPA|чино́вник}}
* {{audio|uk|Uk-чиновник.ogg}}

===Noun===
{{uk-noun|чино́вник&lt;pr&gt;|f=чино́вниця|adj=чино́вницький}}

# [[official]], [[functionary]], [[bureaucrat]]
#: {{syn|uk|урядо́вець}}

====Declension====
{{uk-ndecl|чино́вник&lt;pr&gt;}}

====Derived terms====
* {{l|uk|чино́вництво|g=n}}

===Further reading===
* {{R:uk:SUM-11}}
* {{R:uk:Horokh}}
* {{R:uk:Kyiv}}
* {{R:uk:Slovnyk}}

{{C|uk|Male people|Occupations}}</text>
        <sha1>om5bwhxhzxn132w4po4sv2u6hobn7hg</sha1>
    </revision>
    </page>
===================================================
";

    
    pub const TEXT2: &str = "
<page>
<title>палец</title>
<ns>0</ns>
<id>7514</id>
<revision>
  <id>79591116</id>
  <parentid>78321391</parentid>
  <timestamp>2024-06-02T10:06:18Z</timestamp>
  <contributor>
    <username>WingerBot</username>
    <id>2024159</id>
  </contributor>
  <minor />
  \00\0\00\0\0
  <origin>79591116</origin>
  <model>wikitext</model>
  <format>text/x-wiki</format>
  <text bytes=\"4171\" sha1=\"fwunm419pnksvsspwjpwebj744797a0\" xml:space=\"preserve\">{{also|пялец}}
==Belarusian==
{{wikipedia|lang=be}}

===Alternative forms===
* {{alt|be|palec||Łacinka}}

===Etymology===
{{inh+|be|sla-pro|*pàlьcь||thumb, finger}}.

===Pronunciation===
* {{be-IPA|па́лец}}
* {{rhymes|be|alʲet͡s|s=2}}
* {{audio|be|Be-палец.ogg}}

===Noun===
{{be-noun|па́лец&lt;*&gt;}}

# {{lb|be|anatomy}} [[finger]]
#: {{coi|be|[[адбі́так]] '''па́льца'''|t=[[fingerprint]]}}
# {{lb|be|anatomy}} [[toe]]

====Declension====
{{be-ndecl|па́лец&lt;*&gt;}}

===References===
* {{R:be:slounik.org}}

==Bulgarian==

===Etymology===
From {{inh|bg|sla-pro|*pàlьcь}}.

===Pronunciation===
* {{bg-IPA|па́лец}}

===Noun===
{{bg-noun|па́лец|m}}

# [[thumb]]
# [[big toe]], [[great toe]], [[hallux]]
# {{lb|bg|technology}} [[pin]], [[pawl]], [[tapper]], [[finger]], [[detent]]

====Declension====
{{bg-ndecl|па́лец&lt;*&gt;}}

====Related terms====
* {{l|bg|па́лка}}, {{l|bg|па́лица||stick}}

===References===
* {{R:bg:RBE}}
* {{R:bg:RBE2}}

==Macedonian==

===Etymology===
{{inh+|mk|sla-pro|*pàlьcь||thumb, finger}}.

===Pronunciation===
* {{mk-IPA}}
* {{audio|mk|LL-Q9296 (mkd)-Bjankuloski06-палец.wav}}

===Noun===
{{mk-noun|m|dim=палче}}

# [[thumb]]

====Declension====
{{mk-decl-noun-m||палц|fe=1}}

==Russian==

===Alternative forms===
* {{alter|ru|па́лецъ||ru-PRO}}

===Etymology===
{{inh+|ru|sla-pro|*pàlьcь||thumb, finger}}.

===Pronunciation===
* {{ru-IPA|па́лец}}
* {{audio|ru|Ru-палец.ogg}}

===Noun===
{{ru-noun+|па́лец|*|adj=пальцево́й|adj2=па́льцевый|adj3=па́лечный|dim=па́льчик}}

# [[finger]] or [[toe]]
#: {{syn|ru|перст|q1=archaic or poetic}}
#: {{uxi|ru|[[па́лец ноги́]]|toe}}
#: {{uxi|ru|[[большо́й па́лец]]|[[thumb]]; [[big toe]]}}
#: {{uxi|ru|[[указа́тельный па́лец]]|[[forefinger]], [[index finger]]}}
#: {{uxi|ru|[[сре́дний па́лец]]|[[middle finger]]}}
#: {{uxi|ru|[[безымя́нный па́лец]]|[[ring finger]]}}
#: {{uxi|ru|[[мизи́нец]]|[[little finger]], [[little toe]]}}
#: {{uxi|ru|[[предохрани́тельный]] ([[рези́новый]]) '''па́лец'''|[[finger stall]]}}
#: {{uxi|ru|'''па́лец''' [[о]] '''па́лец''' [[не]] [[уда́рить]]|not to lift a finger}}
#: {{uxi|ru|'''па́льцем''' [[не]] [[шевелить|шевельну́ть]]|not to lift a finger}}
#: {{uxi|ru|[[он|ему́]] '''па́льца''' [[в]] [[рот]] [[не]] [[класть|клади́]]|he is not to be trifled with (watch your step with him)}}
#: {{uxi|ru|[[смотре́ть]] [[сквозь]] '''па́льцы''' [[на]] [[что́-либо]]|to look through one’s fingers at something; to wink at something}}
#: {{uxi|ru|[[обвести́]] [[вокру́г]] '''па́льца'''|to [[cheat]], to [[dupe]], to [[deceive]], to [[take]] in}}
#: {{uxi|ru|[[он]] '''па́льцем''' [[никто|никого́]] [[не]] [[трогать|тро́нет]]|he wouldn’t hurt a fly}}
#: {{uxi|ru|[[вы́сосать]] [[из]] '''па́льца''' [[что́-либо]]|to [[fabricate]] something; to [[dream]] the whole thing up}}
#: {{uxi|ru|[[знать]] [[что́-либо]] [[как]] [[свой|свои́]] [[пять]] '''па́льцев'''|to have something at one’s fingertips; to know something backwards and forwards, to know something like the back of one’s hand}}
#: {{uxi|ru|[[попа́сть]] '''па́льцем''' [[в]] [[не́бо]]|to be wide of the mark}}
#: {{uxi|ru|[[пока́зывать]] ''or'' [[ука́зывать]] '''па́льцем''' [[на]] ''+ acc.''|to point one’s finger at}}
#: {{uxi|ru|[[знать]] [[как]] [[свой|свои́]] [[пять]] '''па́льцев'''|to know very well}}
#: {{uxi|ru|[[кость|ко́сти]] '''па́льцев'''|finger bones}}
#: {{uxi|ru|[[кость|ко́сти]] '''па́льцев''' [[нога|ног]]|toe bones}}
# (''technical'') ([[crank]]) [[pin]], [[finger]], [[cam]]

====Declension====
{{ru-noun-table|па́лец|*}}

{{topics|ru|Body parts|Fingers}}</text>
  <sha1>fwunm419pnksvsspwjpwebj744797a0</sha1>
</revision>
</page>


";

    pub const TEXT3: &'static str = "<page>
    <title>байка</title>
    <ns>0</ns>
    <id>4571678</id>
    <revision>
      <id>79835628</id>
      <parentid>78869316</parentid>
      <timestamp>2024-06-02T16:50:52Z</timestamp>
      <contributor>
        <username>WingerBot</username>
        <id>2024159</id>
      </contributor>
      <minor />
    \0\0\0\0\0\0\0\0\0\0\0\0
    <origin>79835628</origin>
      <model>wikitext</model>
      <format>text/x-wiki</format>
      <text bytes=\"2012\" sha1=\"2yljpl7jgocmqwzppsz3gev3laql0t6\" xml:space=\"preserve\">{{also|бајка}}
==Dolgan==

===Noun===
{{head|dlg|noun|tr=bayka}}

# side parts of the [[sledge]], of the [[sleigh]]

==Russian==

===Pronunciation===
* {{ru-IPA|ба́йка}}

===Etymology 1===
{{root|ru|ine-pro|*bʰeh₂-|id=speak}}
{{inh+|ru|sla-pro|*bajьka}}.

====Noun====
{{ru-noun+|ба́йка|*|adj=ба́ечный|dim=ба́ечка}}

# [[fable]], [[fairy-tale]], old wives' tales

=====Declension=====
{{ru-noun-table|ба́йка|*}}
{{ru-noun-table|ба́йка|*|old=1}}

===Etymology 2===
Per Vasmer, probably borrowed from {{bor|ru|nl|baai}}, from {{der|ru|fr|baie||[[woolen]] [[matter]]}}, from {{m|fr|bai||[[chestnut]]-[[colored]], [[bay]]}}, from {{der|ru|la|badius||[[chestnut]]-[[colored]], [[bay]]}}. First attested in 1720.

====Noun====
{{ru-noun+|ба́йка|*|n=sg|adj=ба́йковый}}

# [[baize]], (thick) [[flannelette]]

=====Declension=====
{{ru-noun-table|ба́йка|*|n=sg}}
{{ru-noun-table|ба́йка|*|n=sg|old=1}}

=====Derived terms=====
* {{l|ru|ба́йковый}}

=====Descendants=====
* {{desc|sah|баайка|bor=1}}

{{topics|ru|Fabrics|Fiction}}

==Ukrainian==

===Pronunciation===
* {{uk-IPA|ба́йка}}
* {{audio|uk|Uk-байка.ogg}}

===Etymology 1===
{{root|uk|ine-pro|*bʰeh₂-|id=speak}}
{{inh+|uk|sla-pro|*bajьka}}.

====Noun====
{{uk-noun|ба́йка&lt;*&gt;|adj=ба́єчний}}

# [[fable]], [[fairy-tale]]

=====Declension=====
{{uk-ndecl|ба́йка&lt;*&gt;}}

=====Derived terms=====
{{der3|uk|
|ба́єчник
|байкар
|байкарство
|байківниця
}}
 
===Etymology 2===
Per Vasmer, probably borrowed from {{bor|uk|nl|baai}}, from {{der|uk|fr|baie||[[woolen]] [[matter]]}}, from {{m|fr|bai||[[chestnut]]-[[colored]], [[bay]]}}, from {{der|uk|la|badius||[[chestnut]]-[[colored]], [[bay]]}}. First attested in 1720.

====Noun====
{{uk-noun|ба́йка&lt;*.sg&gt;|adj=ба́йковий}}

# [[baize]]

=====Declension=====
{{uk-ndecl|ба́йка&lt;*.sg&gt;}}

===References===
* {{R:uk:Horokh}}

{{c|uk|Fabrics|Fiction}}</text>
      <sha1>2yljpl7jgocmqwzppsz3gev3laql0t6</sha1>
    </revision>
  </page>
      ";

}

#[test]
fn general() {

    let russian = select_unto_language_header(constants::TEXT1, "==Russian==").expect("selecting unto language");
    // println!("Russian: \n\n{russian}\n\n");
    
    let sections = split_sections(russian);
    
    println!("\n\nSections:\n{sections:#?}");
    
    assert!(sections.len() == 3);
    
    let pronunciation_section = &sections[0];
    let noun_section_1 = &sections[1];
    let noun_section_2 = &sections[2];

    assert!(sections[0].0 == SectionHeader::Pronunciation);

    assert!(pronunciation_section.1.contains("* {{ru-IPA|чино́вник}}"));
    assert!(!pronunciation_section.1.contains("{{ru-noun+|чино́вник|a=an|f=чино́вница|adj=чино́вничий}}"));
    
    assert!(!noun_section_1.1.contains("* {{ru-IPA|чино́вник}}"));
    assert!(noun_section_1.1.contains("{{ru-noun+|чино́вник|a=an|f=чино́вница|adj=чино́вничий}}"));

    assert!(!noun_section_2.1.contains("{{ru-noun+|чино́вник|a=an|f=чино́вница|adj=чино́вничий}}"));

    assert!(noun_section_1.1.contains("====Related terms===="));
    assert!(!noun_section_2.1.contains("====Related terms===="));

}


#[test]
fn final_headers_parse_correctly() {
    let russian = select_unto_language_header(constants::TEXT2, "==Russian==").expect("msg");
    let sections = split_sections(russian);

    assert!(sections[0].0 == SectionHeader::AlternativeForms);
    assert!(sections[1].0 == SectionHeader::Etymology);
    assert!(sections[2].0 == SectionHeader::Pronunciation);
    assert!(sections[3].0 == SectionHeader::Noun);
    assert!(sections.get(4).is_none());
}



#[test]
fn headers() {

    let belarusian = select_unto_language_header(constants::TEXT2, "==Belarusian==").expect("splitting at belarusian");
    let sections = split_sections(belarusian);

    let alternate_forms = &sections[0];
    assert_eq!(alternate_forms.0, SectionHeader::AlternativeForms);
    
    let etymology = &sections[1];
    assert_eq!(etymology.0, SectionHeader::Etymology);
}


#[test]
fn anomaly_1() {
    let ukrainian = select_unto_language_header(constants::TEXT3, "==Ukrainian==").expect("splitting!");
    let sections = split_sections(ukrainian);
}

